<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <title>chatSocketAchex.js</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- bootstrap -->
  <style>
 
 

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	font-family: Consolas, Monaco, 'Andale Mono', monospace;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	position: relative;
	margin: .5em 0;
	-webkit-box-shadow: -1px 0px 0px 0px #358ccb, 0px 0px 0px 1px #dfdfdf;
	-moz-box-shadow: -1px 0px 0px 0px #358ccb, 0px 0px 0px 1px #dfdfdf;
	box-shadow: -1px 0px 0px 0px #358ccb, 0px 0px 0px 1px #dfdfdf;
	border-left: 10px solid #358ccb;
	background-color: #fdfdfd;
	background-image: -webkit-linear-gradient(transparent 50%, rgba(69, 142, 209, 0.04) 50%);
	background-image: -moz-linear-gradient(transparent 50%, rgba(69, 142, 209, 0.04) 50%);
	background-image: -ms-linear-gradient(transparent 50%, rgba(69, 142, 209, 0.04) 50%);
	background-image: -o-linear-gradient(transparent 50%, rgba(69, 142, 209, 0.04) 50%);
	background-image: linear-gradient(transparent 50%, rgba(69, 142, 209, 0.04) 50%);
	background-size: 3em 3em;
	background-origin: content-box;
	overflow: visible;
	max-height: 30em;
}

code[class*="language"] {
	max-height: inherit;
	height: 100%;
	padding: 0 1em;
	display: block;
	overflow: auto;
}

/* Margin bottom to accomodate shadow */
:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background-color: #fdfdfd;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	box-sizing: border-box;
	margin-bottom: 1em;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	position: relative;
	padding: .2em;
	-webkit-border-radius: 0.3em;
	-moz-border-radius: 0.3em;
	-ms-border-radius: 0.3em;
	-o-border-radius: 0.3em;
	border-radius: 0.3em;
	color: #c92c2c;
	border: 1px solid rgba(0, 0, 0, 0.1);
}

pre[class*="language-"]:before,
pre[class*="language-"]:after {
	content: '';
	z-index: -2;
	display: block;
	position: absolute;
	bottom: 0.75em;
	left: 0.18em;
	width: 40%;
	height: 20%;
	-webkit-box-shadow: 0px 13px 8px #979797;
	-moz-box-shadow: 0px 13px 8px #979797;
	box-shadow: 0px 13px 8px #979797;
	-webkit-transform: rotate(-2deg);
	-moz-transform: rotate(-2deg);
	-ms-transform: rotate(-2deg);
	-o-transform: rotate(-2deg);
	transform: rotate(-2deg);
}

:not(pre) > code[class*="language-"]:after,
pre[class*="language-"]:after {
	right: 0.75em;
	left: auto;
	-webkit-transform: rotate(2deg);
	-moz-transform: rotate(2deg);
	-ms-transform: rotate(2deg);
	-o-transform: rotate(2deg);
	transform: rotate(2deg);
}

 

.namespace {
	opacity: .7;
}

@media screen and (max-width: 767px) {
	pre[class*="language-"]:before,
	pre[class*="language-"]:after {
		bottom: 14px;
		-webkit-box-shadow: none;
		-moz-box-shadow: none;
		box-shadow: none;
	}

}

/* Plugin styles */
.token.tab:not(:empty):before,
.token.cr:before,
.token.lf:before {
	color: #e0d7d1;
}

/* Plugin styles: Line Numbers */
pre[class*="language-"].line-numbers {
	padding-left: 0;
}

pre[class*="language-"].line-numbers code {
	padding-left: 3.8em;
}

pre[class*="language-"].line-numbers .line-numbers-rows {
	left: 0;
}

/* Plugin styles: Line Highlight */
pre[class*="language-"][data-line] {
	padding-top: 0;
	padding-bottom: 0;
	padding-left: 0;
}
pre[data-line] code {
	position: relative;
	padding-left: 4em;
}
pre .line-highlight {
	margin-top: 0;
}
</style>
 
    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
 
      
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<script>
// src="chatSocketAchex.js"


$.fn.extend({ChatSocket: function(opciones) {
	var ChatSocket=this;				
                    var idChat=$(ChatSocket).attr('id');
	defaults = { ws,
                          Room:"RoomMRDURSTintG001",
                          pass:"jhfjHlsFF2230x",
                          lblTitulChat:" Chats für ",
                          lblCampoEntrada:"Message",
                          lblSenden:"Send",
                          textoAyuda:myUrlImg(),
 /*+"&ahnung=zzt",*/
                          Nombre:"Anonym",                          
                          urlImg:myUrlImg (),
                          btnEntrar:"btnEntrar",
                          btnSenden:"btnSenden",
                          lblBtnSenden:"Senden",
                          lblTxtEntrar:"txtEntrar",
                          lblTxtSenden:"txtMessage",
                          lblBtnEntrar:"Enter",
                          idDialogo:"DialogoEntrada",
                          classChat:"",
                          idOnline:"ListaOnline",
                          lblUsuariosOnline:"Users joined: <span id='totalusr'>0</span>",
                        lblEntradaNombre:"Name:",
                        panelColor:"success"
        			}
					
                     var opciones = $.extend({}, defaults, opciones);		
                     var ws;
                     var Room=opciones.Room;
                     var pass=opciones.pass;
                     var lblTitulChat=opciones.lblTitulChat;
                     var lblCampoEntrada=opciones.lblCampoEntrada;
                     var lblSenden=opciones.lblBtnSenden;
                     var textoAyuda=opciones.textoAyuda;
                     var Nombre=opciones.Nombre;                     
                     var urlImg=opciones.urlImg;
                     var btnEntrar=opciones.btnEntrar;
                     var btnSenden=opciones.btnSenden;
                     var lblBtnSenden=opciones.lblBtnSenden;
                     var lblTxtEntrar=opciones.lblTxtEntrar;
                     var lblTxtSenden=opciones.lblTxtSenden;
                     var lblBtnEntrar=opciones.lblBtnEntrar;
                     var idDialogo=opciones.idDialogo;
                     var classChat=opciones.classChat;
                     var idOnline=opciones.idOnline;
                     var lblUsuariosOnline=opciones.lblUsuariosOnline;
                     var lblEntradaNombre=opciones.lblEntradaNombre;
                     var panelColor=opciones.panelColor;
                    if( $('#'+idOnline).length==0 )
                    {
                     idOnline=idChat+"listaOnline";
                        $('#'+idChat).append('<br/><div id="'+idOnline+'"></div>');
                        
                    }
    
    
    // SERVER : ws://achex.ca:4010

            function IniciarConexion(){
                    conex='{"setID":"'+Room+'","passwd":"'+pass+'"}';
                    ws= new WebSocket("ws://achex.ca:4010");
                    ws.onopen= function(){ ws.send(conex); }
                    ws.onmessage= function(Messages){
                    var MessagesObtenidos=Messages.data;
                    var obj = jQuery.parseJSON(MessagesObtenidos);
                    AgregarItem(obj);
                    
                    if(obj.sID!=null){
                        
                                                      
                    if( $('#'+obj.sID).length==0 )
                    {
                   var intx =   $('#totalusr').text();
                            $('#totalusr').text(1+(intx *1) );
 $('#listaOnline').append('<li class="list-group-item" id="'+obj.sID+'"><span style="; padding:1px;font-size:1.5em;" class="label label-success">'+myIcon+ '</span><span style="background:black;color:white; padding:1px;font-size:1.5em;" >'+intx +'</span>  - '+obj.Nombre+'</li>');
myIcon  = otherIcon.split(",")[intx *1];
	 
 
                        
                    }
                     
                    }
                    
                }
                ws.onclose= function(){
                    alert("Conexión cerrada");
                }
          }
           IniciarConexion();
          function iniciarChat(){
            Nombre=$('#'+lblTxtEntrar).val();
            $('#'+idDialogo).hide();
              $('#'+idOnline).show();
           
        var  newTEXTe ="ccccccccccc";
            CrearChat();  
            UsuarioOnline();
            getOnline();
          }
           
          function CrearEntrada(){
          $('#'+idChat).append('<div id="'+idDialogo+'" class="'+classChat+'" id="InputNombre"><div class="panel-footer" style="margin-top:100px;"><div class="input-group"><input id="'+lblTxtEntrar+'" type="text" class="form-control input-sm" value="'+lblEntradaNombre+'"><span class="input-group-btn"><button id="'+btnEntrar+'" class="btn btn-success btn-sm" >'+lblBtnEntrar+'</button></span></div></div></div>');
         $('#'+idOnline).append(' <div class="panel panel-'+panelColor+'"><div class="panel-heading"><span class="glyphicon glyphicon-user"></span> '+lblUsuariosOnline+'</div><div class="panel-body"><ul class="list-group" id="listaOnline"></ul></div><div class="panel-footer"><div class="input-group"><div><a href="https://mglich.github.io/web/">  Github</a></div></span></div></div></div>');
              $("#"+lblTxtEntrar).keyup(function (e) {if (e.keyCode == 13) { iniciarChat(); }});
              $("#"+btnEntrar).click(function(){
              iniciarChat();
              });
        }
          function CrearChat(){
             $('#'+idChat ).append( '<div class="'+classChat+'"><div class="panel panel-'+panelColor+'"><div class="panel-heading"><span class="glyphicon glyphicon-comment"></span>'+lblTitulChat+" : "+Nombre+'<div class="btn-group pull-right"><button type="button" onclick="alert(\''+textoAyuda+'\')" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-chevron-down"></span></button></div></div><div class="panel-body"><ul class="chatpluginchat"></ul></div><div class="panel-footer"><div class="input-group"><input id="'+lblTxtSenden+'" type="text" class="form-control input-sm inputyyy" value="2222222222" /><span class="input-group-btn"><button  class="btn btn-warning btn-sm" id="'+btnSenden+'">'+lblSenden+'</button></span></div></div></div></div><li class="left clearfix itemtemplate" style="display:none"><span class="chat-img pull-left"><img src="'+urlImg+'" alt="Usr" class="img-circle" id="Foto"/></span><div class="chat-body clearfix"><div class="header"><strong class="primary-font" id="Nombre">Nombre</strong><small class="pull-right text-muted"><span class="glyphicon glyphicon-asterisk"></span><span id="Tiempo">12 mins ago</span></small></div> <p id="Contenido">Contenido</p></div></li>');
              
    $("#"+lblTxtSenden).keyup(function (e) {if (e.keyCode == 13) { SendenMessage();}});
    $("#"+btnSenden).click(function () {SendenMessage();});
              
        }
     
        function SendenMessage(){
           ws.send('{"to":"'+Room+'","Nombre":"'+Nombre+'","Contenido":"'+$('#'+lblTxtSenden).val()+'"}');
        $("#"+lblTxtSenden).val('');
          
        };

        function SendenMyMessage(){
           ws.send('{"to":"'+Room+'","Nombre":"'+Nombre+'","Contenido":"'+$('#'+lblTxtSenden).val()+'"}');
        $("#"+lblTxtSenden).val('');
          
        };
        function UsuarioOnline(){
           ws.send('{"to":"'+Room+'","Nombre":"'+Nombre+'"}');
        }
        function AgregarItem(Obj){
            
            if((Obj.Contenido!=null)&&(Obj.Nombre!=null)){
                
            $( ".itemtemplate" ).clone().appendTo( ".chatpluginchat" );
            $('.chatpluginchat .itemtemplate').show(10);
            $('.chatpluginchat .itemtemplate #Nombre').html(Obj.Nombre);alert(Obj.Nombre);
            $('.chatpluginchat .itemtemplate #Contenido').html(Obj.Contenido);
             
             var formattedDate = new Date();
             var d = formattedDate.getUTCDate();
             var m =  formattedDate.getMonth();
             var y = formattedDate.getFullYear();
             var h= formattedDate.getHours();
             var min= formattedDate.getMinutes();
            
            Fecha=d+"/"+m+"/"+y+" "+h+":"+min;
            
            $('.chatpluginchat .itemtemplate #Tiempo').html(Fecha);
            $('.chatpluginchat .itemtemplate').removeClass("itemtemplate");
            }
        }
           function getOnline() {
                setInterval(UsuarioOnline, 5000);
            }
           
         
         CrearEntrada();
    // Fin
    
	}
});
</script>
<script>
var otherIcon  =  "😎‍,🚚‍,🚒‍,🏍‍,😎‍,😎‍,😎‍,😎‍,😎‍,😎‍";

 
 var myIcon  ="🏋️";
 var myName  = "Markus‍";
let uriText = encodeURI(myIcon);

const myUrlImg = (x)  => {  return "" } // "http://placehold.it/50/55C1E7/fff&text="+x;}
</script>
       <style>
.chatpluginchat
{
    list-style: none;
    margin: 0;
    padding: 0;
}

.chatpluginchat li
{
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px dotted #B3A9A9;
}

.chatpluginchat li.left .chat-body
{
    margin-left: 60px;
}

.chatpluginchat li.right .chat-body
{
    margin-right: 60px;
}


.chatpluginchat li .chat-body p
{
    margin: 0;
    color: #777777;
}

.panel .slidedown .glyphicon, .chatpluginchat .glyphicon
{
    margin-right: 5px;
}

.panel-body
{
    overflow-y: scroll;
    height: 250px;
}

::-webkit-scrollbar-track
{
    -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
    background-color: #F5F5F5;
}

::-webkit-scrollbar
a{
    width: 12px;
    background-color: #F5F5F5;
}

::-webkit-scrollbar-thumb
{
    -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
    background-color: #555;
}

</style>
             
  </head>
  <body>
    <div class="container">
        <div class="row">
            <div class="col-md-4 text-center">
         

 
                 </div>  
          </div>
            
    <div class="col-md-8">
        <br/> 
  
 
        <div class="row alert alert-info">
        
         <div class="col-lg-4">
            <div id="ListaOnline">
               
            </div>
            
         </div>   
         
          <div class="col-lg-8">            
          <div id="Elchat"></div>
          </div>   
</div> 
        
      <script type="text/javascript">
var  proptname=  prompt('finalname:',  myName);
       try {    $('#Elchat').ChatSocket({'lblEntradaNombre': proptname});
	} catch(f){console.log('error #Elchat.ChatSocket')} ;
  try { $('#btnEntrar').click() } catch(f){console.log('error btnEntrar')} ;
try { SendenMessage()} catch(f){console.log(f.message)}

        </script>
             
          <div class="panel panel-default">
            <div class="panel-heading"><h1>&nbsp;</h1></div>
        </div>
  </div>
    
        </div>
    </div>
 <script type="text/javascript">
 
 function apiCall() {
(async () => {
    var resp = await fetch(`https://script.google.com/macros/s/AKfycbyG_q2X_5K_UYP9nqPI7Lh0ZophIQK5v3bcnCkt4lges1vqcz4AdFQ3Ji8-SiarB9D7qA/exec?uri=zz11222`);  
    var jobj = await resp.json();  
    var display = jobj.data;  
    console.log(display);
})();
 }
        </script>
<button id="imessage"  onClick=" $('input')[1].value='Ich bin jetzt dabei';">Ich bin jetzt dabei</button>
<button  onClick=" document.getElementById('imessage').click(); btnSenden.click()">X </button>
<button  onClick="apiCall()">y </button>
     
  </body>


<style>
  <style>
  .containerX * {
        list-style: none;
        padding: 0;
    }
    
 .containerX *   p {
        color: #444;
    }
    
.containerX *  button:focus {
        outline: 0;
    }
    
    .containerX {
        
        margin: 0 auto;
        padding: 10px 50px;
        text-align: center;
        
        
    }
    
    .containerX h1 {
        margin-bottom: 5px;
    }
    
   .containerX * .page-description {
        font-size: 1.1rem;
        margin: 0 auto;
    }
    
   .containerX * .tz-link {
        font-size: 1em;
        color: #1da7da;
        text-decoration: none;
    }
    
  .no-browser-support {
        display: none;
        font-size: 1.2rem;
        color: #e64427;
        margin-top: 35px;
    }
    
  .containerX *  .app {
        margin: 2px 1px;
    }
    
  .containerX *  #note-textarea {
        margin: 5px 0;
        min-width: 50%;
        font-size: 1.2rem; 
    }
    
  .containerX *  #recording-instructions {
        margin: 15px auto 20px;
    }
    
  .containerX *  #notes {
        list-style: none;
         padding-top: 10px;
         
    }
  .containerX *   .note  {
      background-color: lightblue;
      border-style: 3px dotted red;
      border-radius: 15px;
      margin-right: 10%;
     }
  .containerX *  .note .header {
        font-size: 0.9em;
        color: #888;
        margin-bottom: 10px;
    }
    
   .containerX * .note .delete-note,
   .containerX * .note .listen-note,
   .containerX * .note .sel-note {
        text-decoration: none;
        margin-left: 15px;
    }
</style>

 <div id="conta_x" class="containerX">
            <div class="app"> 
                 <div class="input-single">
                    <textarea id="note-textarea" placeholder="Nachricht tippen und/oder einsprechen" rows="3"></textarea>
                </div>         
                <button id="start-record-btn" title="Start Recording">Starte🔊</button>
                <button id="pause-record-btn" title="Pause Recording">Pause 🔇</button>
                <button id="save-note-btn" title="Save Note">💾</button>   
                <!--p id="recording-instructions">ggf. Spracherkennung im Browser authorisieren</p-->
                
                <h3>Meine Notizen/Nachrichten</h3>
                <ul id="notes">
                    <li>
                        <p class="no-notes">Keine Nachricht/Notiz</p>
                    </li>
                </ul>
            </div>
        </div>
 <div>
   <ul id="containery">
   </ul>

    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script>
            try {
              var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
              var recognitionN = new SpeechRecognition();
            recognitionN.lang = 'de-DE';
            }
            catch(e) {
              console.error(e);
              $('.no-browser-support').show();
              $('.app').hide();
            }
            
            
            var noteTextarea = $('#note-textarea');
            var instructions = $('#recording-instructions');
            var notesList = $('ul#notes');
            
            var noteContent = '';
            
            // Get all notes from previous sessions and display them.
            var notes = getAllNotes();
            renderNotes(notes);


            /*-----------------------------
                  Voice Recognition 
            ------------------------------*/
            
            // If false, the recording will stop after a few seconds of silence.
            // When true, the silence period is longer (about 15 seconds),
            // allowing us to keep recording even when the user pauses. 
            
            recognitionN.continuous = true;
            
            // This block is called every time the Speech APi captures a line. 
            recognitionN.onresult = function(event) {
            
              // event is a SpeechRecognitionEvent object.
              // It holds all the lines we have captured so far. 
              // We only need the current one.
              var current = event.resultIndex;
            
              // Get a transcript of what was said.
              var transcript = event.results[current][0].transcript;
            
              // Add the current transcript to the contents of our Note.
              // There is a weird bug on mobile, where everything is repeated twice.
              // There is no official solution so far so we have to handle an edge case.
              var mobileRepeatBug = (current == 1 && transcript == event.results[0][0].transcript);
            
              if(!mobileRepeatBug) {
                noteContent += transcript;
                noteTextarea.val(noteContent);
              }
            };
            
            recognitionN.onstart = function() { 
              instructions.text('Spracherkennung aktiviert. Sprich ins Mikrofon.');
            }
            
            recognitionN.onspeechend = function() {
              instructions.text('kein weiterer Input? Spracherkennung wird deaktiviert');
            }
            
            recognitionN.onerror = function(event) {
              if(event.error == 'no-speech') {
                instructions.text('Spracherkennung kann keine Sprache erkennen. Versuch es noch einmal.');  
              };
            }            
            
            
            /*-----------------------------
                  App buttons and input 
            ------------------------------*/
            
            $('#start-record-btn').on('click', function(e) {
              if (noteContent.length) {
                noteContent += ' ';
              }
              recognitionN.start();
            });
            
            
            $('#pause-record-btn').on('click', function(e) {
              recognitionN.stop();
              instructions.text('Voice recognition paused.');
            });
            
            // Sync the text inside the text area with the noteContent variable.
            noteTextarea.on('input', function() {
              noteContent = $(this).val();
            })
            noteTextarea.on('focus', function() {
              noteContent = $(this).val();
            })
            
            $('#save-note-btn').on('click', function(e) {
              recognitionN.stop();
            
              if(!noteContent.length) {
                instructions.text('Leere Notiz kann nicht gespeichert werden. Text in Nachricht eingeben.');
              }
              else {
                // Save note to localStorage.
                // The key is the dateTime with seconds, the value is the content of the note.
                saveNote(new Date().toLocaleString(), noteContent);
            
                // Reset variables and update UI.
                noteContent = '';
                renderNotes(getAllNotes());
                noteTextarea.val('');
                instructions.text('erfolgreich gespeichert!');
              }
                  
            })
            
            
            notesList.on('click', function(e) {
              e.preventDefault();
              var target = $(e.target);
            
              // Listen to the selected note.
              if(target.hasClass('listen-note')) {
                var content = target.closest('.note').find('.content').text();
                readOutLoud(content);
              }
            
              // Delete note.
              if(target.hasClass('delete-note')) {
                var dateTime = target.siblings('.date').text();  
                deleteNote(dateTime);
                target.closest('.note').remove();
              }
                          // Select note.
              if(target.hasClass('sel-note')) {
                let containery = document.getElementById("containery");
                 var content = target.closest('.note').find('.content').text();
             containery.innerHTML+= '<li>'+content+' </li>';
              document.getElementById("note-textarea").value = containery.innerText; document.getElementById("note-textarea").focus();
              }  
            });
                       
            
            /*-----------------------------
                  Speech Synthesis 
            ------------------------------*/
            
            function readOutLoud(message) {
                var speech = new SpeechSynthesisUtterance();
            
              // Set the text and voice attributes.
                speech.lang = 'de-DE';
                speech.text = message;
                speech.volume = 1;
                speech.rate = 0.85;
                speech.pitch = 1;
                window.speechSynthesis.speak(speech);
            }
            
                         
            /*-----------------------------
                  Helper Functions 
            ------------------------------*/
            
            function renderNotes(notes) {
              var html = '';
              if(notes.length) {
                notes.forEach(function(note) {
                  html+= `<li class="note"><p class="header"><span class="date">${note.date}</span><a href="#" class="listen-note" title="Listen to Note">Notiz anhören</a><a href="#" class="delete-note" title="Delete">löschen</a><a href="#" class="sel-note" title="Sel">select</a> <p class="content">${note.content}</p></p> </li>`;   
                });
              }
              else {
                html = '<li><p class="content">You don\'t have any notes yet.</p></li>';
              }
              notesList.html(html);
            }
                        
            function saveNote(dateTime, content) {
              localStorage.setItem('note-' + dateTime, content);
            }
            
            
            function getAllNotes() {
              var notes = [];
              var key;
              for (var i = 0; i < localStorage.length; i++) {
                key = localStorage.key(i);
            
                if(key.substring(0,5) == 'note-') {
                  notes.push({
                    date: key.replace('note-',''),
                    content: localStorage.getItem(localStorage.key(i))
                  });
                } 
              }
              return notes;
            }
                        
            function deleteNote(dateTime) {
              localStorage.removeItem('note-' + dateTime); 
            }

        </script>
</html>
